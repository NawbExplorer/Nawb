var h=Object.create,l=Object.defineProperty,b=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty,R=Object.getOwnPropertyNames,E=Object.getOwnPropertyDescriptor;var S=e=>l(e,"__esModule",{value:!0});var N=(e,r,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of R(r))!y.call(e,a)&&a!=="default"&&l(e,a,{get:()=>r[a],enumerable:!(n=E(r,a))||n.enumerable});return e},I=e=>N(S(l(e!=null?h(b(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var u={type(e,r){return Object.prototype.toString.call(e)===`[object ${r}]`},string(e){return this.type(e,"String")},object(e){return this.type(e,"Object")},function(e){return this.type(e,"Function")},asyncFunction(e){return this.type(e,"AsyncFunction")},null(e){return this.type(e,"Null")},undefined(e){return this.type(e,"Undefined")},number(e){return this.type(e,"Number")},array(e){return this.type(e,"Array")}},g=function(e){delete require.cache[require.resolve(e)];let r=require(e);return r.default?r.default:r};var P=async function(e,r=!1){r&&delete require.cache[require.resolve("./lib/yarn")];var n=require("./lib/yarn"),a=process.argv.findIndex(o=>o==="--");await n.main({startArgs:process.argv.slice(0,2),args:e,endArgs:a===-1?[]:process.argv.slice(a)})};var v=function(e){var r="miao-plugin";return e?e.startsWith(r)||e.includes(r):!1},p=async function(e){if(!v(e))return!1;try{return await P(["add","name"]),!0}catch(r){return!1}};var t={INSTALL_PKG:"installPkg",DEVICE_INFO:"deviceInfo",EXEC_JS:"execJs",ERROR_REPORT:"errorReport",SHOW_TOAST:"showToast",NODEJS_INIT_SUCCESS:"nodejsInitSuccess",NODEJS_INIT_ERROR:"nodejsInitError",PLUGIN_SEARCH:"pluginSearch",PLUGIN_RENDER:"pluginRender"};var d=require("rn-bridge"),f=async function(e,r){let n=g(e);if(!n&&n.pages)throw new Error("illegal plug-in check for properties");let a=n.pages,o;for(let s in a){let c=a[s];if(c.entry&&!(r==null?void 0:r.name)){o=c.page(r.params);break}else if(r)if(s===r.name){o=c.page(r.params);break}else console.log(s,r.name,"not equal")}let i="render-"+e;d.channel.post(i,{eventName:i,action:t.PLUGIN_RENDER,data:o})},m=async function(e,r){var i;let n=g(e);if(typeof((i=n==null?void 0:n.search)==null?void 0:i.api)!="function")throw new Error("plugin does not have search api");let a=await n.search.api(r),o="search-"+e;d.channel.post(o,{eventName:o,action:t.PLUGIN_SEARCH,data:a})};var rnBridge=require("rn-bridge");process.chdir(rnBridge.app.datadir()+"/nodejs-project");try{rnBridge.channel.setMaxListeners(Infinity),rnBridge.channel.post("global",{action:t.NODEJS_INIT_SUCCESS}),rnBridge.channel.on("global",async msg=>{console.log(msg,"global@@@@@@");try{if(u.object(msg))switch(msg.action){case t.PLUGIN_RENDER:f(msg.name,msg.route);break;case t.PLUGIN_SEARCH:m(msg.name,msg.keywords);break;case t.DEVICE_INFO:global.deviceInfo=msg.deviceInfo;break;case t.INSTALL_PKG:p(msg.packageName);break;case t.EXEC_JS:eval(msg.script);break;default:break}}catch(e){console.error(e,"error======="),rnBridge.channel.post("global",{action:t.ERROR_REPORT,error:String(e)})}})}catch(e){rnBridge.channel.post("global",{action:t.NODEJS_INIT_ERROR,error:String(e)})}
